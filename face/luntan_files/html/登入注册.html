<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登入/注册</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 10px;
            background: linear-gradient(to right, #ecf, #8cf);
            transition: all 0.5s ease;
        }

        html::before {
            content: "";
            position: fixed;
            height: 100%;
            width: 100%;
            z-index: -1;
            backdrop-filter: blur(5px);
        }

        ::selection {
            color: #fff;
            background-color: #6cf;
        }

        .logon {
            display: flex;
            overflow: hidden;
            width: 700px;
            height: 450px;
            background-color: rgb(255, 2555, 255, 85%);
            border-radius: 10px;
            box-shadow: 0 0 5px 10px rgb(0, 0, 0 / 10%);
            margin: 10% auto;
        }

        .close {
            opacity: 0;
        }

        .logon .left {
            position: relative;
            width: 35%;
            height: 100%;
            background-color: skyblue;
        }

        .logon .left::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: url("../img/Bg4.jpg");
            background-size: cover;
            background-position: 20% 0;
            opacity: 80%;
        }

        .logon .right-1 {
            display: flex;
            width: 65%;
            padding: 0 5%;
            flex-direction: column;
            align-items: center;
        }

        .logon .right-1 form {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .logon .right-1 h4 {
            font-size: 25px;
            color: #6cf;
            margin-top: 20px;
        }

        .logon .right-1 form .acc {
            outline: none;
            width: 80%;
            height: 30px;
            font-size: 15px;
            margin-top: 10%;
            padding: 10px 0 0 15px;
            border: none;
            border-bottom: 1px solid #6cf;
            color: #6cf;
            background-color: rgb(0, 0, 0, 0);
        }

        .logon .right-1 form .acc:hover {
            outline: none;
            padding: 10px 0 0 15px;
            color: #6cf;
        }

        .right-1 .Login {
            width: 60%;
            height: 30px;
            color: #fff;
            background-image: linear-gradient(120deg, #ecf 0%, #8cf 100%);
            font-size: 15px;
            border: none;
            border-radius: 5px;
            margin: 50px 0 0 50%;
            transform: translateX(-50%);
            cursor: pointer;
        }

        .right-1 .Login:hover {
            box-shadow: 0 0 2px -1px rgb(0 0 0 / 15%);
        }

        .right-1 .fn {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            width: 70%;
        }

        .right-1 .fn a {
            font-size: 12px;
            margin-top: 10px;
            padding: 2px 5px;
            color: #666;
        }

        .right-1 .fn a:hover {
            color: #6cf;
        }

        .right-2 {
            animation: move 1s ease;
        }

        .logon .right-2 {
            display: flex;
            width: 65%;
            padding: 0 5%;
            flex-direction: column;
            align-items: center;
        }

        .logon .right-2 form {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .logon .right-2 form .acc {
            outline: none;
            width: 85%;
            height: 30px;
            font-size: 15px;
            margin-top: 10%;
            padding: 10px 0 0 15px;
            border: none;
            border-bottom: 1px solid #6cf;
            color: #6cf;
            background-color: rgb(0, 0, 0, 0);
        }

        .right-2 .form-text {
            font: 600 20px '';
            color: #6cf;
            margin-top: 12%;
        }

        .right-2 .text-sex {
            font: 600 20px '';
            color: #6cf;
            margin-top: 5%;
            margin-right: 5%;
        }

        .right-2 .text-address {
            font: 600 20px '';
            color: #6cf;
        }


        .logon .right-2 form .bir {
            width: 25%;
            margin-top: 10%;
        }

        .right-2 .address {
            width: 25%;
            height: 20px;
            border: 1px solid #6cf;
            color: #6cf;
            margin-top: 1%;
            cursor: pointer;
        }

        .right-2 .sex {
            width: 20%;
            height: 20px;
            margin: 6% 50% 5% 0;
            border: 1px solid #ecf;
            color: #6cf;
            background-color: rgb(255, 255, 255, 60%);
            transform: translateX(-25%);
            cursor: pointer;
        }

        .right-2 .submit {
            width: 80%;
            height: 10%;
            padding: 0 10%;
            background-image: linear-gradient(120deg, #6cf 0%, #ecf 100%);
            color: #fff;
            border: none;
            border-radius: 5px;
            margin-top: 10%;
            cursor: pointer;
        }

        .right-2 .button {
            width: 30%;
            height: 8%;
            background-color: #6cf;
            color: #fff;
            border: none;
            border-radius: 5px;
            margin: 5% 0 0 50%;
            cursor: pointer;
        }

        .right-2 .button:hover {
            box-shadow: 0 0 1px 2px #6cf;
        }
    </style>
</head>

<body>
    <div class="logon">
        <div class="left">
        </div>
        <div class="right-1" v-show="r1">
            <h4>Welcome</h4>
            <form action="首页.html">
                <input class="acc" id="username" type="text" placeholder="用户名">
                <input class="acc" id="password" type="password" placeholder="密码">
                <input class="Login" id="Login" type="submit" value="Login">
            </form>
            <div class="fn">
                <a href="#" id="toright" @click="rt1">注册账户</a>
                <a href="#">忘记密码</a>
            </div>
        </div>
        <div class="right-2" v-show="r2">
            <form id="form-logon">
                <input class="acc" type="text" id="logon-count" placeholder="用户名">
                <input class="acc" type="password" id="logon-password" placeholder="密码">
                <span class="form-text">生日：</span>
                <input class="acc bir" type="text" id="birthday-y" placeholder="年">
                <input class="acc bir" type="text" id="birthday-m" placeholder="月">
                <input class="acc bir" type="text" id="birthday-d" placeholder="日">

                <span class="text-sex">性别：</span>
                <select id="sex" class="sex">
                    <option value="--">--</option>
                    <option value="男">男</option>
                    <option value="女">女</option>
                </select>
                <span class="text-address">地址：</span>
                <select id="province" class="address">
                    <option value="--">--</option>
                    <option value="北京">北京</option>
                    <option value="天津">天津</option>
                    <option value="河北省">河北省</option>
                    <option value="山西省">山西省</option>
                    <option value="内蒙古自治区">内蒙古自治区</option>
                    <option value="辽宁省">辽宁省</option>
                    <option value="吉林省">吉林省</option>
                    <option value="黑龙江省">黑龙江省</option>
                    <option value="上海">上海</option>
                    <option value="江苏省">江苏省</option>
                    <option value="浙江省">浙江省</option>
                    <option value="安徽省">安徽省</option>
                    <option value="福建省">福建省</option>
                    <option value="江西省">江西省</option>
                    <option value="山东省">山东省</option>
                    <option value="河南省">河南省</option>
                    <option value="湖北省">湖北省</option>
                    <option value="湖南省">湖南省</option>
                    <option value="广东省">广东省</option>
                    <option value="广西壮族自治区">广西壮族自治区</option>
                    <option value="海南省">海南省</option>
                    <option value="重庆">重庆</option>
                    <option value="四川省">四川省</option>
                    <option value="贵州省">贵州省</option>
                    <option value="云南省">云南省</option>
                    <option value="西藏自治区">西藏自治区</option>
                    <option value="陕西省">陕西省</option>
                    <option value="甘肃省">甘肃省</option>
                    <option value="青海省">青海省</option>
                    <option value="宁夏回族自治区">宁夏回族自治区</option>
                    <option value="新疆维吾尔自治区">新疆维吾尔自治区</option>
                    <option value="台湾">台湾</option>
                    <option value="香港特别行政区">香港特别行政区</option>
                    <option value="澳门特别行政区">澳门特别行政区</option>
                </select>
                <select id="city" class="address">
                    <option value="--">--</option>
                </select>
                <select id="area" class="address">
                    <option value="--">--</option>
                </select>
                <input type="submit" value="注册" id="logon-button" class="submit" @click.prevent>
                <input type="button" value="返回登入" id="backtologon" class="button" @click="rt2">
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>

        //登录注册切换
        const test = new Vue({
            el: '.logon',
            data: {
                r1: true,
                r2: false
            },
            methods: {
                rt1() {
                    this.r1 = !this.r1;
                    this.r2 = !this.r2;
                },
                rt2() {
                    this.r1 = !this.r1;
                    this.r2 = !this.r2;
                },
            }
        });

        //注册
        document.getElementById("logon-button").addEventListener("click", function () {
            const xhr = new XMLHttpRequest();
            let username = document.getElementById("logon-count").value;
            let password = document.getElementById("logon-password").value;
            let birthdayy = document.getElementById("birthday-y").value;
            let birthdaym = document.getElementById("birthday-m").value;
            let birthdayd = document.getElementById("birthday-d").value;
            let birthday = birthdayy + "年" + birthdaym + "月" + birthdayd + "日";
            let sex = document.getElementById("sex").value;
            let province = document.getElementById("province").value;
            let city = document.getElementById("city").value;
            let country = document.getElementById("area").value;

            xhr.open("post", "http://127.0.0.1:8081/api/sign_in", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            const data = {
                username,
                password,
                sex,
                birthday,
                country,
                province,
                city
            };

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log(xhr.response);
                }
            }
            xhr.send(JSON.stringify(data));
        })

        //城市请求

        //清除原有数据
        document.getElementById("province").addEventListener("change", function () {
        let count = document.getElementById("city").childNodes.length;
        const select = document.getElementById("city");
        if (count > 2) {
            while (count > 2) {
                select.removeChild(select.childNodes[2]);
                count--;
            }
        }
        })
        document.getElementById("province").addEventListener("change", function () {
            let pname = document.getElementById("province").value;
            const qobj = {
                pname
            }
            let p = new URLSearchParams(qobj);
            let queryString = p.toString();
            let url = "http://hmajax.itheima.net/api/city?" + queryString;

            const xhr = new XMLHttpRequest;
            xhr.open("get", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.addEventListener("loadend", function () {
                const d = JSON.parse(xhr.response);
                const data = d.list;
                const select = document.getElementById("city");

                let count = document.getElementById("city").childNodes.length;
                if (count > 1) {
                    while (count > 1) {
                        select.removeChild(select.childNodes[1]);
                        count--;
                    }
                }
                for (i = 0; i < data.length; i++) {
                    const a = document.createElement("option");
                    a.text = data[i];
                    a.value = data[i];
                    document.getElementById("city").appendChild(a);
                }
            })
            xhr.send();
        })

        //区查询

        //清除原有数据
        document.getElementById("province").addEventListener("change", function () {
            let count = document.getElementById("area").childNodes.length;
            const select = document.getElementById("area");
            if (count > 1) {
                while (count > 1) {
                    select.removeChild(select.childNodes[1]);
                    count--;
                }
            }
        })

        //获取输入数据
        document.getElementById("city").addEventListener("change", function () {
            let pname = document.getElementById("province").value;
            let cname = document.getElementById("city").value;
            const qobj = {
                pname,
                cname
            }
            let p = new URLSearchParams(qobj);
            let queryString = p.toString();
            let url = "http://hmajax.itheima.net/api/area?" + queryString;

            const xhr = new XMLHttpRequest;
            xhr.open("get", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.addEventListener("loadend", function () {
                const d = JSON.parse(xhr.response);
                const data = d.list;
                const select = document.getElementById("area");

                let count = document.getElementById("area").childNodes.length;
                if (count > 1) {
                    while (count > 1) {
                        select.removeChild(select.childNodes[1]);
                        count--;
                    }
                }
                for (i = 0; i < data.length; i++) {
                    const a = document.createElement("option");
                    a.text = data[i];
                    a.value = data[i];
                    document.getElementById("area").appendChild(a);
                }
            })
            xhr.send();
        })

        //背景颜色切换
        function bgchange() {
            const html = document.documentElement
            const img = [
                'linear-gradient(to right, #ecf, #8cf)',
                'linear-gradient(to right, #abdcff, #0396ff)',
                'linear-gradient(to right, #ce9ffc, #7367f0)',
                'linear-gradient(to right, #f97794, #623aa2)'
            ]
            const image = img[Math.floor(Math.random() * img.length)];

            html.style.background = image;
        }

        setInterval(bgchange, 3000);

        //登陆事件 Axios.XHR+Promise
        function logonAxios(config) {
            return new Promise((result, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open(config.method || "post", config.url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.addEventListener("loadend", () => {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        //成功获取用户信息
                        // userif(config.username);
                        result(xhr.response);
                    } else {
                        reject(new Error(xhr.response));
                    }
                })
                xhr.send(JSON.stringify(config.data));
            })
        }

        //获取用户信息
        function userif(config) {
            axios({
                method: "get",
                url: "http://127.0.0.1:8081/api/get_user_info",
                params: {
                    username: config.username
                }
            }).then(result => {
                console.log(result);
                // localStorage.setItem("sex", "");
                // localStorage.setItem("birthday", "");
                // localStorage.setItem("province", "");
                // localStorage.setItem("city", "");
                // localStorage.setItem("countury", "");
                // localStorage.setItem("status", true);
            }).catch(error => {
                console.dir(error);
            })
        }

        document.getElementById("Login").addEventListener("click", function () {
            logonAxios(
                {
                    method: "post",
                    url: "http://127.0.0.1:8081/api/sign_up",
                    data: {
                        username: document.getElementById("username").value,
                        password: document.getElementById("password").value
                    }
                }
            ).then(result => {
                console.log(result);
            }).catch(error => {
                console.log(error);
            })
        })

    </script>
</body>

</html>